import{j as H,r as _,k as E,E as i,d as J,o as K,c as f,e as T,g as B,f as t,w as l,n as b,p as L,u as q,q as V,s as I,x as O,y as P,h as c,z as Q,_ as W}from"./index-CQldnOsZ.js";const X=H("admin",()=>{const p=_([]),u=_(!1),g=_(null);return{categories:p,loading:u,error:g,fetchAllData:async()=>{u.value=!0,g.value=null;try{p.value=await E.getCategories()}catch(r){const a=r;g.value=a.message||"加载数据失败",i.error("加载数据失败")}finally{u.value=!1}},createCategory:async r=>{var a,m;try{const n=await E.createCategory(r);return p.value.push(n),i.success("创建分类成功"),n}catch(n){const d=n;throw i.error(((m=(a=d.response)==null?void 0:a.data)==null?void 0:m.message)||"创建分类失败"),n}},updateCategory:async(r,a)=>{var m,n;try{const d=await E.updateCategory(r,a),w=p.value.findIndex(A=>A.id===r);return w!==-1&&(p.value[w]=d),i.success("更新分类成功"),d}catch(d){const w=d;throw i.error(((n=(m=w.response)==null?void 0:m.data)==null?void 0:n.message)||"更新分类失败"),d}},deleteCategory:async r=>{var a,m;try{await E.deleteCategory(r),p.value=p.value.filter(n=>n.id!==r),i.success("删除分类成功")}catch(n){const d=n;throw i.error(((m=(a=d.response)==null?void 0:a.data)==null?void 0:m.message)||"删除分类失败"),n}}}}),Y={class:"categories-container"},Z={class:"header"},ee={key:1},ae={class:"dialog-footer"},te=J({__name:"Categories",setup(p){const u=X(),{categories:g,loading:U}=u,v=_(!1),y=_("add"),x=_(),r=_(!1),a=_({name:"",icon:"",sort:0,is_show:!0}),m={name:[{required:!0,message:"请输入分类名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],icon:[{max:50,message:"图标名称不能超过 50 个字符",trigger:"blur"}],sort:[{required:!0,message:"请输入排序值",trigger:"blur"}]};K(async()=>{g.value.length===0&&await u.fetchAllData()});const n=s=>{y.value=s?"edit":"add",s?a.value={...s}:a.value={name:"",icon:"",sort:0,is_show:!0},v.value=!0},d=async()=>{if(x.value){await x.value.validate(),r.value=!0;try{y.value==="add"?await u.createCategory(a.value):await u.updateCategory(a.value.id,a.value),i.success(y.value==="add"?"添加成功":"更新成功"),v.value=!1,await u.fetchAllData()}catch{i.error(y.value==="add"?"添加失败":"更新失败")}finally{r.value=!1}}},w=async s=>{try{await P.confirm(`确定要删除分类"${s.name}"吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await u.deleteCategory(s.id),i.success("删除成功"),await u.fetchAllData()}catch(e){e!=="cancel"&&i.error("删除失败")}},A=async s=>{try{await u.updateCategory(s.id,{id:s.id,is_show:s.is_show}),i.success("更新成功")}catch{s.is_show=!s.is_show,i.error("更新失败")}};return(s,e)=>{const h=c("el-button"),C=c("el-table-column"),$=c("el-icon"),N=c("el-switch"),M=c("el-button-group"),R=c("el-table"),S=c("el-input"),k=c("el-form-item"),j=c("el-input-number"),z=c("el-form"),F=c("el-dialog"),G=Q("loading");return f(),T("div",Y,[B("div",Z,[e[8]||(e[8]=B("h2",null,"分类管理",-1)),t(h,{type:"primary",onClick:e[0]||(e[0]=o=>n())},{default:l(()=>e[7]||(e[7]=[b("添加分类")])),_:1})]),L((f(),V(R,{data:q(g),style:{width:"100%"}},{default:l(()=>[t(C,{prop:"id",label:"ID",width:"80"}),t(C,{prop:"name",label:"名称"}),t(C,{prop:"icon",label:"图标",width:"100"},{default:l(({row:o})=>[o.icon?(f(),V($,{key:0},{default:l(()=>[(f(),V(I(o.icon)))]),_:2},1024)):(f(),T("span",ee,"-"))]),_:1}),t(C,{prop:"sort",label:"排序",width:"100"}),t(C,{prop:"is_show",label:"显示",width:"100"},{default:l(({row:o})=>[t(N,{modelValue:o.is_show,"onUpdate:modelValue":D=>o.is_show=D,onChange:D=>A(o),loading:o.updating},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])]),_:1}),t(C,{label:"操作",width:"200"},{default:l(({row:o})=>[t(M,null,{default:l(()=>[t(h,{type:"primary",onClick:D=>n(o)},{default:l(()=>e[9]||(e[9]=[b("编辑")])),_:2},1032,["onClick"]),t(h,{type:"danger",onClick:D=>w(o)},{default:l(()=>e[10]||(e[10]=[b("删除")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[G,q(U)]]),t(F,{title:y.value==="add"?"添加分类":"编辑分类",modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=o=>v.value=o),width:"500px"},{footer:l(()=>[B("span",ae,[t(h,{onClick:e[5]||(e[5]=o=>v.value=!1)},{default:l(()=>e[11]||(e[11]=[b("取消")])),_:1}),t(h,{type:"primary",onClick:d,loading:r.value},{default:l(()=>e[12]||(e[12]=[b("确定")])),_:1},8,["loading"])])]),default:l(()=>[t(z,{ref_key:"formRef",ref:x,model:a.value,rules:m,"label-width":"80px"},{default:l(()=>[t(k,{label:"名称",prop:"name"},{default:l(()=>[t(S,{modelValue:a.value.name,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.name=o),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),t(k,{label:"图标",prop:"icon"},{default:l(()=>[t(S,{modelValue:a.value.icon,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.icon=o),placeholder:"请输入图标名称"},{append:l(()=>[a.value.icon?(f(),V($,{key:0},{default:l(()=>[(f(),V(I(a.value.icon)))]),_:1})):O("",!0)]),_:1},8,["modelValue"])]),_:1}),t(k,{label:"排序",prop:"sort"},{default:l(()=>[t(j,{modelValue:a.value.sort,"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.sort=o),min:0,max:999},null,8,["modelValue"])]),_:1}),t(k,{label:"显示",prop:"is_show"},{default:l(()=>[t(N,{modelValue:a.value.is_show,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.is_show=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}}),le=W(te,[["__scopeId","data-v-fb898989"]]);export{le as default};
